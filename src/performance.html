<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance Control - Acoustic Automaton</title>
  <style>
    .performance-page * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    .performance-page {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #ffffff;
      color: #1a1a1a;
      padding: 2rem;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .performance-page h1 {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #1a1a1a;
    }

    .performance-page .subtitle {
      font-size: 1rem;
      color: #666;
      margin-bottom: 2rem;
    }

    /* ステータス表示 */
    .status-panel {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .status-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .status-label {
      font-size: 0.875rem;
      color: #666;
      font-weight: 500;
    }

    .status-value {
      font-size: 1.5rem;
      font-weight: 600;
      color: #1a1a1a;
    }

    .status-value.active {
      color: #4caf50;
    }

    .status-value.paused {
      color: #ff9800;
    }

    .status-value.stopped {
      color: #999;
    }

    /* コントロールボタン */
    .control-panel {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .control-panel h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1a1a1a;
    }

    .visual-crop-section {
      margin-top: 1.5rem;
      padding: 1rem;
      border: 1px solid #d4d4d4;
      border-radius: 6px;
      background: #fafafa;
    }

    .visual-crop-section h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: #1f2a3a;
    }

    .visual-crop-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.5rem 1rem;
      margin-bottom: 0.75rem;
    }

    .visual-crop-grid label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.875rem;
      color: #333;
      gap: 0.5rem;
    }

    .visual-crop-grid input[type="number"] {
      width: 90px;
      padding: 0.35rem 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .visual-crop-toggles {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 0.75rem;
      font-size: 0.875rem;
      color: #333;
    }

    .visual-crop-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 0.5rem 1rem;
      margin-bottom: 0.75rem;
    }

    .visual-crop-options label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.875rem;
      color: #333;
      gap: 0.5rem;
    }

    .visual-crop-options input,
    .visual-crop-options select {
      flex: 1;
      padding: 0.35rem 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .visual-crop-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      margin-top: 0.5rem;
    }

    .visual-crop-actions button {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      border-radius: 4px;
      border: 1px solid #2a2a2a;
      background: #2a2a2a;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .visual-crop-actions button:hover {
      background: #1a1a1a;
    }

    .visual-crop-actions button#perf-reset-crop-btn {
      background: #f0f0f0;
      color: #1a1a1a;
      border-color: #ccc;
    }

    .visual-crop-actions button#perf-reset-crop-btn:hover {
      background: #e0e0e0;
    }

    .button-group {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .container button {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 500;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #ffffff;
      color: #1a1a1a;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 120px;
    }

    .container button:hover {
      background: #f5f5f5;
      border-color: #999;
    }

    .container button:active {
      background: #e8e8e8;
      transform: translateY(1px);
    }

    .container button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .container button.primary {
      background: #2a2a2a;
      color: #ffffff;
      border-color: #2a2a2a;
    }

    .container button.primary:hover {
      background: #1a1a1a;
      border-color: #1a1a1a;
    }

    .container button.primary:active {
      background: #0a0a0a;
    }

    .container button.danger {
      background: #f44336;
      color: #ffffff;
      border-color: #f44336;
    }

    .container button.danger:hover {
      background: #d32f2f;
      border-color: #d32f2f;
    }

    .container button.success {
      background: #4caf50;
      color: #ffffff;
      border-color: #4caf50;
    }

    .container button.success:hover {
      background: #45a049;
      border-color: #45a049;
    }

    /* ログ表示 */
    .log-panel {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .log-panel h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1a1a1a;
    }

    #log-output {
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 1rem;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.875rem;
      line-height: 1.5;
      color: #333;
    }

    #log-output div {
      margin-bottom: 0.25rem;
    }

    /* トラック管理 */
    .track-panel {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1.5rem;
    }

    .track-panel h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1a1a1a;
    }

    /* セクション制御 */
    .section-control {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .section-control h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1a1a1a;
    }

    .section-selector {
      margin-bottom: 1rem;
    }

    .section-selector label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .section-selector select {
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #ffffff;
      color: #1a1a1a;
    }

    .playback-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #ddd;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .info-item .label {
      font-size: 0.875rem;
      color: #666;
      font-weight: 500;
    }

    .info-item .value {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1a1a1a;
    }

    .track-list {
      display: grid;
      gap: 0.75rem;
    }

    .track-item {
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 1rem;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 1rem;
    }

    .track-info {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .track-name {
      font-weight: 600;
      color: #1a1a1a;
    }

    .track-status {
      font-size: 0.875rem;
      color: #666;
    }

    .track-status.active {
      color: #4caf50;
      font-weight: 500;
    }

    /* リンクセクション */
    .links-section {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid #ddd;
    }

    .links-section h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1a1a1a;
    }

    .links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .link-card {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 1rem;
      text-decoration: none;
      color: #1a1a1a;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .link-card:hover {
      background: #e8e8e8;
      border-color: #999;
      transform: translateY(-2px);
    }

    .link-title {
      font-weight: 600;
      font-size: 1rem;
    }

    .link-description {
      font-size: 0.875rem;
      color: #666;
    }
  </style>
</head>

<body class="performance-page">
  <div class="container">
    <h1>Performance Control</h1>
    <p class="subtitle">Acoustic Automaton Live Electronics Performance System</p>

    <!-- ステータスパネル -->
    <div class="status-panel">
      <div class="status-grid">
        <div class="status-item">
          <span class="status-label">Status</span>
          <span class="status-value stopped" id="performance-state">Stopped</span>
        </div>
        <div class="status-item">
          <span class="status-label">Elapsed Time</span>
          <span class="status-value" id="elapsed-time">00:00</span>
        </div>
        <div class="status-item">
          <span class="status-label">Active Tracks</span>
          <span class="status-value" id="active-tracks">0</span>
        </div>
        <div class="status-item">
          <span class="status-label">Audio Status</span>
          <span class="status-value" id="audio-status">Ready</span>
        </div>
      </div>
    </div>

    <!-- セクション制御パネル -->
    <div class="section-control">
      <h2>Section Control</h2>
      <!-- Removed unintended empty div -->
      <div class="section-selector">
        <label for="section-select">Select Section to Play From:</label>
        <select id="section-select">
          <option value="">-- Select Section (or start from beginning) --</option>
        </select>
      </div>

      <div class="playback-info">
        <div class="info-item">
          <span class="label">Current Section:</span>
          <span id="current-section" class="value">--</span>
        </div>
        <div class="info-item">
          <span class="label">Musical Time:</span>
          <span id="musical-time" class="value">Bar 1, Beat 1</span>
        </div>
        <div class="info-item">
          <span class="label">Tempo:</span>
          <span id="current-tempo" class="value">60 BPM</span>
        </div>
      </div>
    </div>

    <!-- コントロールパネル -->
    <div class="control-panel">
      <h2>Performance Controls</h2>
      <div class="button-group">
        <button id="play-btn" class="success">Play</button>
        <button id="pause-btn" disabled>Pause</button>
        <button id="stop-btn" class="danger" disabled>Stop</button>
        <button id="reset-btn">Reset</button>
      </div>
    </div>

    <!-- ビジュアルコントロールパネル -->
    <div class="control-panel">
      <h2>Visual Controls</h2>
      <div class="button-group">
        <button id="toggle-visuals-btn" class="primary">Disable Visuals</button>
        <button id="open-visualizer-btn">Open Visualizer Window</button>
      </div>
      <div class="button-group" style="margin-top: 1rem;">
        <button id="fullscreen-mode-btn" class="primary">Fullscreen Mode</button>
        <button id="preview-mode-btn">Preview Mode (800x600)</button>
      </div>
      <div class="status-info" style="margin-top: 1rem;">
        <span class="status-label">Visual Status:</span>
        <span id="visual-status" class="status-value">Enabled</span>
      </div>
      <div class="status-info" style="margin-top: 0.5rem;">
        <span class="status-label">Display Mode:</span>
        <span id="display-mode-status" class="status-value">Fullscreen</span>
      </div>
      <div class="button-group" style="margin-top: 1rem;">
        <button id="frame-mode-decorated-btn" class="primary">Window Frame On</button>
        <button id="frame-mode-borderless-btn">Window Frame Off</button>
      </div>
      <div class="status-info" style="margin-top: 0.5rem;">
        <span class="status-label">Window Frame:</span>
        <span id="frame-mode-status" class="status-value">With Frame</span>
      </div>
      <div
        style="margin-top: 0.5rem; padding: 0.5rem; background: #2a2a2a; border-radius: 4px; font-size: 0.8rem; color: #999;">
        ℹ️ Note: Window frame cannot be shown in fullscreen mode. Enabling frame will exit fullscreen.
      </div>

      <div class="visual-crop-section">
        <h3>Viewport Crop</h3>
        <div class="visual-crop-grid">
          <label>Left (%)<input type="number" id="perf-crop-left" value="0" min="0" max="100" step="0.1" /></label>
          <label>Top (%)<input type="number" id="perf-crop-top" value="0" min="0" max="100" step="0.1" /></label>
          <label>Right (%)<input type="number" id="perf-crop-right" value="100" min="0" max="100" step="0.1" /></label>
          <label>Bottom (%)<input type="number" id="perf-crop-bottom" value="100" min="0" max="100" step="0.1" /></label>
        </div>
        <div class="visual-crop-toggles">
          <label><input type="checkbox" id="perf-crop-enabled" /> Enable crop</label>
          <label><input type="checkbox" id="perf-crop-frame" checked /> Show frame</label>
        </div>
        <div class="visual-crop-options">
          <label>Frame color <input type="color" id="perf-crop-frame-color" value="#ffffff" /></label>
          <label>Frame width (px) <input type="number" id="perf-crop-frame-width" value="4" min="0" max="50" step="1" /></label>
          <label>Scale mode
            <select id="perf-crop-scale-mode">
              <option value="contain" selected>Contain (letterbox)</option>
              <option value="cover">Cover (fill)</option>
            </select>
          </label>
          <label>Anchor
            <select id="perf-crop-anchor">
              <option value="center" selected>Center</option>
              <option value="top-left">Top left</option>
            </select>
          </label>
        </div>
        <div class="visual-crop-actions">
          <button id="perf-apply-crop-btn">Apply crop</button>
          <button id="perf-reset-crop-btn">Reset</button>
        </div>
        <div class="status-info" style="margin-top: 0.75rem;">
          <span class="status-label">Crop Status:</span>
          <span id="perf-crop-status" class="status-value">Disabled</span>
        </div>
      </div>

      <!-- Particle Control -->
      <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #444;">
        <h3 style="margin-bottom: 0.5rem; font-size: 0.9rem; color: #aaa;">Particle Performance Test</h3>
        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
          <label for="particle-count-input" style="font-size: 0.85rem;">Particle Count:</label>
          <input type="number" id="particle-count-input" min="100" max="100000" step="100" value="1000"
            style="width: 100px; padding: 0.25rem; background: #2a2a2a; border: 1px solid #444; color: #fff;" />
          <button id="apply-particle-count-btn" style="padding: 0.25rem 0.75rem;">Apply</button>
        </div>
        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
          <button id="particle-1k-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">1K</button>
          <button id="particle-5k-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">5K</button>
          <button id="particle-10k-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">10K</button>
          <button id="particle-50k-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">50K</button>
          <button id="particle-100k-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">100K</button>
        </div>
        <div class="status-info">
          <span class="status-label">Current Particles:</span>
          <span id="particle-count-status" class="status-value">1000</span>
        </div>
        <div class="status-info" style="margin-top: 0.25rem;">
          <span class="status-label">FPS:</span>
          <span id="particle-fps-status" class="status-value">--</span>
        </div>
        <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #444;">
          <button id="show-coordinates-btn" style="padding: 0.35rem 1rem;">
            <span id="coordinates-btn-text">Show Coordinates</span>
          </button>
          <div class="status-info" style="margin-top: 0.5rem;">
            <span class="status-label">Coordinates:</span>
            <span id="coordinates-status" class="status-value">Hidden</span>
          </div>
        </div>
        <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #444;">
          <h4 style="margin-bottom: 0.5rem; font-size: 0.85rem; color: #aaa;">Coordinate Display Mode</h4>
          <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
            <button id="coordinates-mode-panel-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">Panel</button>
            <button id="coordinates-mode-inline-btn"
              style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">Inline</button>
          </div>
          <div class="status-info">
            <span class="status-label">Mode:</span>
            <span id="coordinates-mode-status" class="status-value">Panel</span>
          </div>
        </div>
        <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #444;">
          <h4 style="margin-bottom: 0.5rem; font-size: 0.85rem; color: #aaa;">Attraction Strength</h4>
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
            <input type="range" id="attraction-strength-slider" min="0" max="200" step="1" value="100"
              style="flex: 1; height: 20px;" />
            <span id="attraction-strength-value" style="min-width: 60px; font-size: 0.85rem;">1.00x</span>
          </div>
          <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
            <button id="attraction-0x-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">0x</button>
            <button id="attraction-05x-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">0.5x</button>
            <button id="attraction-1x-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">1x</button>
            <button id="attraction-2x-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">2x</button>
          </div>
          <div class="status-info">
            <span class="status-label">Current Strength:</span>
            <span id="attraction-status" class="status-value">1.00x</span>
          </div>
        </div>
        <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #444;">
          <button id="invert-colors-btn" style="padding: 0.35rem 1rem;">
            <span id="invert-btn-text">Invert Colors</span>
          </button>
          <div class="status-info" style="margin-top: 0.5rem;">
            <span class="status-label">Colors:</span>
            <span id="invert-status" class="status-value">Normal</span>
          </div>
        </div>
      </div>
    </div>

    <!-- トラック管理（将来実装） -->
    <!--
    <div class="track-panel">
      <h2>Audio Tracks</h2>
      <div class="track-list" id="track-list">
        <div class="track-item">
          <div class="track-info">
            <span class="track-name">Track 1</span>
            <span class="track-status">Inactive</span>
          </div>
          <button onclick="toggleTrack(1)">Enable</button>
        </div>
      </div>
    </div>
    -->

    <!-- ログパネル -->
    <div class="log-panel">
      <h2>System Log</h2>
      <div id="log-output">
        <div>🎪 Performance Controller initialized</div>
        <div>✅ System ready for performance</div>
      </div>
    </div>

    <!-- リンクセクション -->
    <div class="links-section">
      <h2>Related Pages</h2>
      <div class="links-grid">
        <a href="/src/controller.html" class="link-card">
          <span class="link-title">🎛️ System Controller</span>
          <span class="link-description">Audio settings and device management</span>
        </a>
        <a href="/src/player.html?player=1" class="link-card">
          <span class="link-title">🎵 Player View</span>
          <span class="link-description">Individual performer interface</span>
        </a>
        <a href="/src/visualizer.html" class="link-card">
          <span class="link-title">👁️ Visualizer</span>
          <span class="link-description">Audio visualization display</span>
        </a>
      </div>
    </div>
  </div>

  <script type="module" src="/src/performance.ts"></script>
</body>

</html>