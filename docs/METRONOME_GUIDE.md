# メトロノーム機能 - ユーザーガイド

## 概要
MusicalTimeManagerに統合されたメトロノーム機能により、音楽的時間軸制御システムのテストと使用が格段に向上しました。

## UIコントロール

### 1. メトロノームOn/Offボタン
- **ボタン**: 🔇 Metronome Off / 🥁 Metronome On
- **機能**: メトロノームの有効化/無効化を切り替え
- **状態表示**: ボタンの色と文字で現在の状態を表示

### 2. 音量スライダー
- **コントロール**: 🔊 Vol: [スライダー] [数値]
- **範囲**: 0.0 - 1.0
- **デフォルト**: 0.3
- **機能**: メトロノーム音量をリアルタイム調整

### 3. テストボタン
- **🥁 Metronome Test**: メトロノーム機能の総合テスト
- **❓ Metronome Help**: 使用例とヘルプ表示

## プログラマブルAPI

### MetronomeUtils
```javascript
// 基本制御
MetronomeUtils.enable()        // メトロノーム有効化
MetronomeUtils.disable()       // メトロノーム無効化
MetronomeUtils.toggle()        // 状態切り替え
MetronomeUtils.setVolume(0.5)  // 音量設定
MetronomeUtils.playTest()      // テストパターン再生

// グローバルヘルパー経由
mtm.metronome.enable()
mtm.metronome.disable()
mtm.metronome.toggle()
mtm.metronome.volume(0.5)
mtm.metronome.test()
```

## 拍の種類と音色

### 🔴 Downbeat (小節頭)
- **周波数**: 880Hz
- **音量**: 最大 (100%)
- **長さ**: 0.3秒
- **重要度**: 最高

### 🟡 Strong Beat (強拍)
- **周波数**: 660Hz
- **音量**: 中 (70%)
- **長さ**: 0.2秒
- **重要度**: 高

### 🟢 Weak Beat (弱拍)
- **周波数**: 440Hz
- **音量**: 小 (50%)
- **長さ**: 0.15秒
- **重要度**: 中

### 🔵 Subdivision (細分化)
- **周波数**: 330Hz
- **音量**: 最小 (30%)
- **長さ**: 0.05秒
- **重要度**: 低

## 使用例

### 1. 基本的な使用
```javascript
// 1. メトロノーム有効化
MetronomeUtils.enable();

// 2. 音楽的時間開始
mtm.start();

// 拍がメトロノームで聞こえます
```

### 2. テンポ変更テスト
```javascript
// メトロノーム有効化
MetronomeUtils.enable();

// 4/4拍子で開始
mtm.start();

// 7/8拍子に変更 - メトロノームパターンが変わります
mtm.tempo(140, 7, 8);
```

### 3. フルパフォーマンステスト
- testFullPerformance() 実行時に自動でメトロノーム有効化
- テンポ変更やセクション変化が音で確認可能

## 技術仕様

### Web Audio API実装
- オシレーター: サイン波
- フィルター: ローパスフィルター（拍の種類に応じた周波数）
- エンベロープ: ADSR（アタック・ディケイ）

### 拍子対応
- 4/4拍子: 標準的な強弱パターン
- 3/4拍子: ワルツパターン
- 7/8拍子: 複雑拍子パターン
- その他: 動的な強拍・弱拍判定

### パフォーマンス最適化
- 音源の動的生成・破棄
- メモリリーク防止
- 低レイテンシー再生

## トラブルシューティング

### メトロノームが聞こえない
1. MusicalTimeManagerが初期化されているか確認
2. ブラウザの音声が有効か確認
3. 音量設定を確認

### 拍のタイミングがずれる
1. ブラウザのオーディオレイテンシー確認
2. CPUリソース使用量確認
3. 他のオーディオアプリケーションとの競合確認

## 今後の拡張予定
- Faustシンセサイザーとの統合
- カスタム音色設定
- MIDI同期機能
- レコーディング機能
