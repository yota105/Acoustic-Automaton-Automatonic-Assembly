# ã‚¹ãƒãƒ›ã¸ã®ãƒ†ã‚¹ãƒˆé€ä¿¡ã‚¬ã‚¤ãƒ‰

## ğŸ“± æ¦‚è¦

ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç”»é¢ã‹ã‚‰ã‚¹ãƒãƒ›ï¼ˆPlayerç”»é¢ï¼‰ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã§ãã¾ã™ï¼

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
# BroadcastChannel + WebSocketãƒªãƒ¬ãƒ¼ã‚’åŒæ™‚èµ·å‹•
npm run dev:full

# ã‚‚ã—ãã¯åˆ¥ã€…ã«èµ·å‹•
npm run ws-relay   # WebSocket ãƒªãƒ¬ãƒ¼ (ãƒãƒ¼ãƒˆ1421)
npm run dev        # Viteé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ (ãƒãƒ¼ãƒˆ1420)
```

### 2. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é–‹ã

```
http://localhost:1420/
```

### 3. ã‚¹ãƒãƒ›ã§Playerç”»é¢ã‚’é–‹ã

åŒã˜Wi-Fiãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã§ï¼š

```
http://ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€‘:1420/src/player.html?player=1
```

IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä»¥ä¸‹ã§ç¢ºèªï¼š
```bash
./network-urls.sh
```

ã¾ãŸã¯ `http://localhost:1420/network-urls.html`

### 4. ãƒ†ã‚¹ãƒˆUIã‚’ä½¿ç”¨

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç”»é¢ã®å³ä¸‹ã«ã€ŒğŸ“± ã‚¹ãƒãƒ›é€ä¿¡ãƒ†ã‚¹ãƒˆã€ãƒ‘ãƒãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚**

ã“ã®ãƒ‘ãƒãƒ«ã‹ã‚‰ï¼š
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›
- é€ä¿¡å…ˆï¼ˆå…¨å“¡/Player 1/2/3ï¼‰ã‚’é¸æŠ
- ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é€ä¿¡ï¼

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### UIã‹ã‚‰ã®é€ä¿¡

#### 1. ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡ ğŸ””
- ã‚¹ãƒãƒ›ã«ã‚¢ãƒ©ãƒ¼ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
- ç¢ºèªãŒå¿…è¦ãªé‡è¦ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ä½¿ç”¨

#### 2. é€šçŸ¥é€ä¿¡ ğŸ’¬
- ç”»é¢ä¸Šéƒ¨ã«3ç§’é–“é€šçŸ¥ã‚’è¡¨ç¤º
- ä¸€æ™‚çš„ãªæƒ…å ±å…±æœ‰ã«ä½¿ç”¨

#### 3. ã‚­ãƒ¥ãƒ¼é€ä¿¡ ğŸ¯
- ç”»é¢ä¸­å¤®ã«å¤§ãããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
- æ¼”å¥ã®ã‚­ãƒ¥ãƒ¼ã‚„æŒ‡ç¤ºã«ä½¿ç”¨

#### 4. ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ â±ï¸
- 4å°ç¯€ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’è¡¨ç¤º
- ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°æŒ‡ç¤ºã«ä½¿ç”¨

#### 5. ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ âš¡
- è‡ªç”±å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
- é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨

---

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã®é€ä¿¡

ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ï¼š

```javascript
// å…¨å“¡ã«ã‚¢ãƒ©ãƒ¼ãƒˆ
playerMessenger.sendTestAlert('ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', 'all');

// Player 1ã«é€šçŸ¥
playerMessenger.sendTestNotification('æº–å‚™ã—ã¦ãã ã•ã„', 3000, '1');

// Player 2ã«ã‚­ãƒ¥ãƒ¼
playerMessenger.sendTestCue('ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼', '#FF9800', '2');

// å…¨å“¡ã«ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆ4å°ç¯€ï¼‰
playerMessenger.sendCountdown(4, 0, 'all');

// Player 3ã«ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
playerMessenger.sendCustomMessage({ custom: true, foo: 'bar' }, '3');
```

---

## ğŸ”§ æŠ€è¡“ä»•æ§˜

### é€šä¿¡æ–¹æ³•

ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°
- **BroadcastChannel API**: åŒä¸€ã‚ªãƒªã‚¸ãƒ³å†…ã§è¶…ä½é…å»¶é€šä¿¡
- **WebSocketãƒªãƒ¬ãƒ¼**: ç•°ãªã‚‹ãƒ‡ãƒã‚¤ã‚¹/ã‚ªãƒªã‚¸ãƒ³ã§ã‚‚ç¢ºå®Ÿã«å±Šã‘ã‚‹
- è‡ªå‹•é‡è¤‡æ’é™¤ï¼†ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆä¸¡æ–¹ã«é€ä¿¡ã—ã¦æœ€åˆã«å±Šã„ãŸæ–¹ã‚’æ¡ç”¨ï¼‰

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼

```typescript
{
    id: 'uuid',      // é‡è¤‡é˜²æ­¢ã®ãŸã‚ã®ä¸€æ„ID
    type: 'test-alert' | 'test-notification' | 'test-cue' | ...,
    target: 'all' | '1' | '2' | '3' | 'controller',  // é€ä¿¡å…ˆ
    data: {
        message: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹',
        // ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿
    },
    timestamp: 1234567890,
    transport: 'broadcast' | 'websocket',
    source: 'controller' | 'player'
}
```

### WebSocketãƒªãƒ¬ãƒ¼ã‚µãƒ¼ãƒãƒ¼

- ã‚¹ã‚¯ãƒªãƒ—ãƒˆ: `tools/websocket-relay.mjs`
- èµ·å‹•: `npm run ws-relay`
- ãƒãƒ¼ãƒˆ: `1421`ï¼ˆç’°å¢ƒå¤‰æ•° `PERFORMANCE_WS_PORT` ã§å¤‰æ›´å¯èƒ½ï¼‰
- ãƒ‘ã‚¹: `/performance`ï¼ˆç’°å¢ƒå¤‰æ•° `PERFORMANCE_WS_PATH` ã§å¤‰æ›´å¯èƒ½ï¼‰
- å½¹å‰²: å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä»–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ä¸­ç¶™ï¼ˆé€ä¿¡å…ƒã«ã¯å†é€ã—ãªã„ï¼‰

### å¯¾å¿œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—

| ã‚¿ã‚¤ãƒ— | èª¬æ˜ | Playerå´ã®è¡¨ç¤º |
|--------|------|----------------|
| `test-alert` | ã‚¢ãƒ©ãƒ¼ãƒˆ | ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º |
| `test-notification` | é€šçŸ¥ | ä¸Šéƒ¨ã«3ç§’é–“è¡¨ç¤º |
| `test-cue` | ã‚­ãƒ¥ãƒ¼ | ä¸­å¤®ã«å¤§ãã3ç§’é–“è¡¨ç¤º |
| `countdown` | ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ | å††å½¢ã‚²ãƒ¼ã‚¸ã§è¡¨ç¤º |
| `custom` | ã‚«ã‚¹ã‚¿ãƒ  | é€šçŸ¥ã¨ã—ã¦è¡¨ç¤º |

---

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### æ–°è¦ä½œæˆ
1. **`src/simpleMessageSender.ts`** - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚·ã‚¹ãƒ†ãƒ 
   - é€ä¿¡é–¢æ•°
   - ãƒ†ã‚¹ãƒˆUIä½œæˆ
   - ã‚°ãƒ­ãƒ¼ãƒãƒ«APIå…¬é–‹

### æ›´æ–°
2. **`src/player.ts`** - Playerç”»é¢ã®å—ä¿¡å‡¦ç†
   - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåˆ¤å®š
   - æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—å¯¾å¿œ
   - `showNotification()` é–¢æ•°è¿½åŠ 
   - `showCueMessage()` é–¢æ•°è¿½åŠ 

3. **`src/controller.ts`** - ãƒ†ã‚¹ãƒˆUIã®åˆæœŸåŒ–
   - `createSimpleTestUI()` å‘¼ã³å‡ºã—

---

## ğŸ’¡ ä½¿ç”¨ä¾‹

### ä¾‹1: ãƒªãƒãƒ¼ã‚µãƒ«ã§ã®æº–å‚™æŒ‡ç¤º

```javascript
// å…¨å“¡ã«æº–å‚™ã‚’ä¿ƒã™
playerMessenger.sendTestNotification('3åˆ†å¾Œã«é–‹å§‹ã—ã¾ã™', 5000, 'all');

// 1åˆ†å‰
playerMessenger.sendTestCue('1åˆ†å‰ï¼', '#FF9800', 'all');

// ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
playerMessenger.sendCountdown(4, 0, 'all');
```

### ä¾‹2: å€‹åˆ¥æŒ‡ç¤º

```javascript
// Player 1ã«ã‚½ãƒ­ã®æº–å‚™
playerMessenger.sendTestCue('æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚½ãƒ­ï¼', '#4CAF50', '1');

// Player 2ã¨3ã¯ä¼‘æ­¢
playerMessenger.sendTestNotification('æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ä¼‘æ­¢', 3000, '2');
playerMessenger.sendTestNotification('æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ä¼‘æ­¢', 3000, '3');
```

### ä¾‹3: ç·Šæ€¥åœæ­¢

```javascript
// å…¨å“¡ã«ã‚¢ãƒ©ãƒ¼ãƒˆ
playerMessenger.sendTestAlert('âš ï¸ æ¼”å¥ã‚’åœæ­¢ã—ã¦ãã ã•ã„', 'all');
```

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šã‹ãªã„

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:**
1. [ ] WebSocketãƒªãƒ¬ãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ï¼Ÿ
    - `npm run dev:full` ã¾ãŸã¯ `npm run ws-relay` ã‚’å®Ÿè¡Œ
    - UIã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«ã€ŒWebSocket: æ¥ç¶šæ¸ˆã¿ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèª

2. [ ] ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¨Playerç”»é¢ãŒåŒã˜ã‚ªãƒªã‚¸ãƒ³ã§é–‹ã„ã¦ã„ã‚‹ï¼Ÿ
    - BroadcastChannelã¯åŒä¸€ã‚ªãƒªã‚¸ãƒ³å†…ã§ã®ã¿å‹•ä½œ
    - **IPã‚¢ã‚¯ã‚»ã‚¹æ¨å¥¨**ï¼š`http://<PCã®IP>:1420/`

3. [ ] Playerç”»é¢ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¨ãƒ©ãƒ¼ã¯ãªã„ï¼Ÿ
   - F12ã§é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã„ã¦ç¢ºèª

4. [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã¯æ­£å¸¸ï¼Ÿ
   - ã‚¹ãƒãƒ›ãŒåŒã˜Wi-Fiã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹

5. [ ] ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæŒ‡å®šã¯æ­£ã—ã„ï¼Ÿ
   - `'1'`, `'2'`, `'3'`, `'all'` ã®ã„ãšã‚Œã‹

### ãƒ†ã‚¹ãƒˆUIãŒè¡¨ç¤ºã•ã‚Œãªã„

```javascript
// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§æ‰‹å‹•ä½œæˆ
playerMessenger.createSimpleTestUI();
```

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼

```javascript
// playerMessengerãŒæœªå®šç¾©ã®å ´åˆ
import { createSimpleTestUI } from './simpleMessageSender';
createSimpleTestUI();
```

---

## ğŸ¨ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### é€šçŸ¥ã®è‰²ã‚’å¤‰æ›´

`src/player.ts` ã® `showNotification()` é–¢æ•°å†…ï¼š

```typescript
background: rgba(33, 150, 243, 0.95);  // é’
â†“
background: rgba(76, 175, 80, 0.95);   // ç·‘
```

### ã‚­ãƒ¥ãƒ¼ã®è¡¨ç¤ºæ™‚é–“ã‚’å¤‰æ›´

`src/player.ts` ã® `showCueMessage()` é–¢æ•°å†…ï¼š

```typescript
setTimeout(() => {
    // ...
}, 3000);  // 3ç§’
â†“
}, 5000);  // 5ç§’
```

### ç‹¬è‡ªã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ 

#### 1. `src/simpleMessageSender.ts` ã«é€ä¿¡é–¢æ•°ã‚’è¿½åŠ 

```typescript
export function sendMyCustomMessage(data: any, target: 'all' | string = 'all') {
    if (target === 'all') {
        return sendToAllPlayers('my-custom-type', data);
    } else {
        return sendToPlayer(target, 'my-custom-type', data);
    }
}
```

#### 2. `src/player.ts` ã«å—ä¿¡å‡¦ç†ã‚’è¿½åŠ 

```typescript
case 'my-custom-type':
    // ç‹¬è‡ªã®å‡¦ç†
    console.log('My custom message:', data);
    showNotification(`ã‚«ã‚¹ã‚¿ãƒ : ${data?.message}`, 3000);
    break;
```

---

## ğŸ“š API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### sendToAllPlayers(type, data)
å…¨Playerã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡

```typescript
sendToAllPlayers('test-notification', { 
    message: 'ã“ã‚“ã«ã¡ã¯', 
    duration: 3000 
});
```

### sendToPlayer(playerId, type, data)
ç‰¹å®šã®Playerã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡

```typescript
sendToPlayer('1', 'test-cue', { 
    message: 'ã‚½ãƒ­é–‹å§‹ï¼', 
    color: '#4CAF50' 
});
```

### sendTestAlert(message, target)
ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é€ä¿¡

```typescript
sendTestAlert('é‡è¦ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', 'all');
```

### sendTestNotification(message, duration, target)
é€šçŸ¥ã‚’é€ä¿¡

```typescript
sendTestNotification('3ç§’è¡¨ç¤ºã•ã‚Œã‚‹é€šçŸ¥', 3000, '2');
```

### sendTestCue(message, color, target)
ã‚­ãƒ¥ãƒ¼ã‚’é€ä¿¡

```typescript
sendTestCue('ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼', '#FF9800', '1');
```

### sendCountdown(bars, beats, target)
ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’é€ä¿¡

```typescript
sendCountdown(4, 0, 'all');  // 4å°ç¯€
```

---

## ğŸ‰ ã¾ã¨ã‚

âœ… ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã‚¹ãƒãƒ›ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€ä¿¡å¯èƒ½  
âœ… UIã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸¡æ–¹ã‹ã‚‰ä½¿ãˆã‚‹  
âœ… å…¨å“¡ã¾ãŸã¯å€‹åˆ¥ã«é€ä¿¡å¯èƒ½  
âœ… 5ç¨®é¡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—  
âœ… ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ»æ‹¡å¼µå¯èƒ½  

**ã“ã‚Œã§ã€ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã®çµæœã‚’ã‚¹ãƒãƒ›ã«é€ä¿¡ã§ãã¾ã™ï¼**

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `NETWORK_SETUP_COMPLETE.md` - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚¬ã‚¤ãƒ‰
- `docs/PERFORMER_TARGETING_GUIDE.md` - å¥è€…åˆ¥æŒ‡ç¤ºã‚·ã‚¹ãƒ†ãƒ 
- `src/simpleMessageSender.ts` - ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
- `src/player.ts` - Playerå´ã®å®Ÿè£…
