# ネットワーク接続ガイド - 演奏者用デバイスの接続方法

## 📱 概要

このシステムでは、複数の演奏者がそれぞれのデバイス（スマートフォン、タブレット、PC）から
個別の演奏者画面にアクセスできます。オペレーターのPCから全体を制御します。

---

## 🔧 セットアップ手順

### 1. ネットワーク接続の確認

**すべてのデバイスを同じWi-Fiネットワークに接続してください。**

- オペレーターPC
- 演奏者1のデバイス
- 演奏者2のデバイス
- 演奏者3のデバイス

### 2. 開発サーバーの起動

オペレーターPCで以下を実行：

```bash
npm run dev
```

ターミナルに以下のような出力が表示されます：

```
VITE v6.3.6  ready in 137 ms

➜  Local:   http://localhost:1420/
➜  Network: http://172.20.10.2:1420/
```

**`Network:`** の後ろに表示されているIPアドレスをメモしてください。

### 3. Network URLs ページを開く

オペレーターPCのブラウザで：

```
http://localhost:1420/network-urls.html
```

または、コントローラー画面の「🌐 Network URLs (演奏者用URL一覧)」ボタンをクリック。

### 4. 演奏者へURLを共有

Network URLsページに表示されている各Player用のURLを、対応する演奏者に共有します。

**方法1: QRコード生成**
- オンラインQRコードジェネレーター（例: qr-code-generator.com）にURLを入力
- 生成されたQRコードを演奏者がスキャン

**方法2: 直接入力**
- URLをメモアプリやチャットアプリで共有
- 演奏者がブラウザに直接入力

---

## 🎵 演奏者用URL

### 演奏者1 (Player 1)
```
http://【IPアドレス】:1420/src/player.html?player=1
```

### 演奏者2 (Player 2)
```
http://【IPアドレス】:1420/src/player.html?player=2
```

### 演奏者3 (Player 3)
```
http://【IPアドレス】:1420/src/player.html?player=3
```

---

## 🎛️ オペレーター用URL

### コントローラー（推奨）
```
http://localhost:1420/src/controller.html
```

### ビジュアライザー
```
http://localhost:1420/src/visualizer.html
```

---

## ⚙️ Vite設定（既に設定済み）

`vite.config.ts` で以下が設定されています：

```typescript
export default defineConfig({
  server: {
    port: 1420,
    strictPort: true,
    host: '0.0.0.0',  // ← ネットワークアクセスを許可
    // ...
  }
});
```

---

## 🔍 トラブルシューティング

### Player画面が表示されない

**原因1: ネットワーク接続の問題**
- すべてのデバイスが同じWi-Fiに接続されているか確認
- オペレーターPCのIPアドレスが変わっていないか確認（Wi-Fi再接続時など）

**原因2: ファイアウォールの問題**
```bash
# macOSの場合
システム環境設定 → セキュリティとプライバシー → ファイアウォール
→ ファイアウォールオプション → "自動的に受信接続を許可"にチェック
```

**原因3: ポート1420がブロックされている**
```bash
# ポートが使用されているか確認
lsof -i :1420
```

### IPアドレスの確認方法

**macOS:**
```bash
# ターミナルで実行
ifconfig | grep "inet " | grep -v 127.0.0.1
```

または、システム環境設定 → ネットワーク で確認。

**Windows:**
```cmd
ipconfig
```

**Linux:**
```bash
ip addr show
```

### dev serverが起動しない

```bash
# ポート1420が既に使用されている可能性
# 別のViteプロセスを終了してから再実行
pkill -f vite
npm run dev
```

---

## 💡 ベストプラクティス

### 事前準備
1. リハーサル前に、すべてのデバイスでPlayer画面が正しく表示されることを確認
2. QRコードを事前に印刷しておくと便利
3. 演奏中にWi-Fiが切れないよう、ルーターの近くで使用

### 本番環境
1. 安定したWi-Fiルーターを使用（5GHz帯推奨）
2. 演奏者のデバイスを充電しておく
3. 画面の自動スリープをOFFに設定

### デバッグ
1. ブラウザの開発者ツール（F12）でコンソールを確認
2. ネットワークタブでリクエストエラーをチェック
3. オペレーターPCのターミナルでサーバーログを確認

---

## 📊 システム構成図

```
[オペレーターPC]
    ↓ Wi-Fi (同じネットワーク)
[Wi-Fiルーター]
    ↓
[演奏者1のデバイス] - Player 1画面
[演奏者2のデバイス] - Player 2画面
[演奏者3のデバイス] - Player 3画面
```

---

## 🚀 クイックスタート

1. オペレーターPC: `npm run dev`
2. ターミナルでNetwork IPを確認
3. `http://localhost:1420/network-urls.html` を開く
4. Player URLをQRコード化
5. 演奏者がQRコードをスキャン
6. 全員の画面が表示されたら準備完了！

---

## 📞 サポート

問題が解決しない場合は、以下を確認してください：

- [ ] すべてのデバイスが同じWi-Fiに接続されている
- [ ] オペレーターPCで `npm run dev` が実行されている
- [ ] ファイアウォールでポート1420が開いている
- [ ] ブラウザのコンソールにエラーが表示されていないか
- [ ] オペレーターPCのターミナルにエラーが表示されていないか

---

## 🔗 関連ファイル

- `vite.config.ts` - Viteサーバー設定
- `network-urls.html` - URL一覧ページ
- `network-urls.sh` - ターミナル用URL表示スクリプト
- `src/player.html` - 演奏者画面
- `src/controller.html` - オペレーター画面
